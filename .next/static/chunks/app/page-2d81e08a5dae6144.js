(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3093:function(e,t,r){Promise.resolve().then(r.bind(r,585))},585:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(7437),s=r(2265);function n(e){let{sessions:t,currentSessionId:r,isRecording:n,noteFiles:d,onSelectSession:o,onCreateSession:l,onStartRecording:i,onStopRecording:c,onUploadFile:u}=e,[x,p]=(0,s.useState)(!1),[m,h]=(0,s.useState)(""),[b,f]=(0,s.useState)(""),[g,v]=(0,s.useState)(!1),k=(0,s.useRef)(null),j=()=>{m.trim()&&(l(m.trim(),b.trim()||"General"),h(""),f(""),p(!1))},y=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){v(!0);try{await u(r)}finally{v(!1),k.current&&(k.current.value="")}}};return(0,a.jsxs)("div",{className:"bg-dark-panel border-b border-dark-border px-4 py-3 flex items-center gap-3 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mr-2",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDF93"}),(0,a.jsx)("span",{className:"font-bold text-lg hidden sm:inline",children:"Class Buddy"})]}),(0,a.jsxs)("select",{className:"bg-dark-bg border border-dark-border rounded px-3 py-1.5 text-sm max-w-[200px] focus:outline-none focus:border-dark-accent",value:r||"",onChange:e=>e.target.value&&o(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Select session..."}),t.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.className,": ",e.name]},e.id))]}),(0,a.jsx)("button",{onClick:()=>p(!x),className:"bg-dark-accent hover:bg-dark-accent-hover text-white text-sm px-3 py-1.5 rounded transition-colors",children:"+ New"}),x&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{className:"bg-dark-bg border border-dark-border rounded px-2 py-1 text-sm w-32 focus:outline-none focus:border-dark-accent",placeholder:"Session name",value:m,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&j()}),(0,a.jsx)("input",{className:"bg-dark-bg border border-dark-border rounded px-2 py-1 text-sm w-28 focus:outline-none focus:border-dark-accent",placeholder:"Class",value:b,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&j()}),(0,a.jsx)("button",{onClick:j,className:"text-sm text-dark-accent hover:text-dark-accent-hover",children:"Create"})]}),(0,a.jsx)("div",{className:"flex-1"}),d.length>0&&(0,a.jsxs)("span",{className:"text-xs text-dark-muted hidden md:inline",children:["\uD83D\uDCCE ",d.length," note",d.length>1?"s":""]}),(0,a.jsx)("input",{ref:k,type:"file",accept:".pdf,.txt,.md,.markdown",className:"hidden",onChange:y}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},disabled:!r||g,className:"bg-dark-bg border border-dark-border text-sm px-3 py-1.5 rounded hover:border-dark-accent disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:g?"Uploading...":"\uD83D\uDCC4 Upload Notes"}),n?(0,a.jsxs)("button",{onClick:c,className:"bg-dark-bg border border-red-500 text-red-400 text-sm px-3 py-1.5 rounded hover:bg-red-500/10 transition-colors flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-red-500 rounded-full recording-pulse"}),"Stop Recording"]}):(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>i("mic"),disabled:!r,className:"bg-red-600 hover:bg-red-500 text-white text-sm px-3 py-1.5 rounded disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:"\uD83C\uDFA4 Mic"}),(0,a.jsx)("button",{onClick:()=>i("tab"),disabled:!r,className:"bg-red-600 hover:bg-red-500 text-white text-sm px-3 py-1.5 rounded disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:"\uD83D\uDD0A Tab Audio"})]})]})}function d(e){let{segments:t}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,a.jsxs)("div",{className:"w-1/2 border-r border-dark-border flex flex-col bg-dark-panel",children:[(0,a.jsx)("div",{className:"px-4 py-3 border-b border-dark-border flex-shrink-0",children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wider",children:"\uD83D\uDCDD Live Transcript"})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[0===t.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-dark-muted text-sm",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-3xl mb-3",children:"\uD83C\uDF99ï¸"}),(0,a.jsx)("p",{children:"No transcript yet."}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Start recording to see live transcription."})]})}):t.map(e=>{var t;return(0,a.jsxs)("div",{className:"group flex gap-3 hover:bg-dark-bg/50 rounded px-2 py-1.5 -mx-2 transition-colors",children:[(0,a.jsx)("span",{className:"text-xs text-dark-accent font-mono mt-0.5 flex-shrink-0 w-12",children:(t=e.timestamp,"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat(Math.floor(t%60).toString().padStart(2,"0")))}),(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:e.text})]},e.id)}),(0,a.jsx)("div",{ref:r})]})]})}function o(e){let{messages:t,onSendMessage:r,sessionId:n}=e,[d,o]=(0,s.useState)(""),[l,i]=(0,s.useState)(!1),c=(0,s.useRef)(null);(0,s.useEffect)(()=>{var e;null===(e=c.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let u=async()=>{let e=d.trim();if(e&&!l){o(""),i(!0);try{await r(e)}finally{i(!1)}}};return(0,a.jsxs)("div",{className:"w-1/2 flex flex-col bg-dark-bg",children:[(0,a.jsx)("div",{className:"px-4 py-3 border-b border-dark-border flex-shrink-0",children:(0,a.jsx)("h2",{className:"text-sm font-semibold text-dark-muted uppercase tracking-wider",children:"\uD83D\uDCAC Q&A Chat"})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===t.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-dark-muted text-sm",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-3xl mb-3",children:"\uD83E\uDD16"}),(0,a.jsx)("p",{children:"Ask questions about the lecture."}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"I'll search the transcript and your notes to answer."})]})}):t.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsx)("div",{className:"max-w-[80%] rounded-lg px-4 py-2.5 text-sm leading-relaxed ".concat("user"===e.role?"bg-dark-accent text-white":"bg-dark-panel border border-dark-border"),children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})})},e.id)),l&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-dark-panel border border-dark-border rounded-lg px-4 py-2.5 text-sm text-dark-muted",children:"Thinking..."})}),(0,a.jsx)("div",{ref:c})]}),(0,a.jsx)("div",{className:"p-4 border-t border-dark-border flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{className:"flex-1 bg-dark-panel border border-dark-border rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-dark-accent placeholder:text-dark-muted disabled:opacity-40",placeholder:n?"Ask about the lecture...":"Select a session first",value:d,disabled:!n||l,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&u()}),(0,a.jsx)("button",{onClick:u,disabled:!n||!d.trim()||l,className:"bg-dark-accent hover:bg-dark-accent-hover text-white px-4 py-2.5 rounded-lg text-sm disabled:opacity-40 disabled:cursor-not-allowed transition-colors",children:"Send"})]})})]})}function l(){let[e,t]=(0,s.useState)(null),[r,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[u,x]=(0,s.useState)([]),[p,m]=(0,s.useState)(!1),[h,b]=(0,s.useState)([]),f=(0,s.useRef)(null),g=(0,s.useRef)(null),v=(0,s.useRef)(0),k=(0,s.useRef)(null);(0,s.useEffect)(()=>{fetch("/api/sessions").then(e=>e.json()).then(l).catch(console.error)},[]),(0,s.useEffect)(()=>{e&&fetch("/api/sessions/".concat(e)).then(e=>e.json()).then(e=>{c(e.transcriptSegments||[]),x(e.chatMessages||[]),b(e.noteFiles||[])}).catch(console.error)},[e]);let j=async(e,r)=>{let a=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,className:r})}),s=await a.json();l(e=>[s,...e]),t(s.id),c([]),x([]),b([])},y=(0,s.useCallback)(async t=>{if(!e||t.size<1e3)return;let r=(Date.now()-v.current)/1e3,a=new FormData;a.append("audio",t,"chunk.webm"),a.append("sessionId",e),a.append("timestamp",r.toString());try{let e=await fetch("/api/transcribe",{method:"POST",body:a}),t=await e.json();t.text&&t.id&&c(e=>[...e,{id:t.id,text:t.text,timestamp:t.timestamp}])}catch(e){console.error("Transcription error:",e)}},[e]),w=async t=>{if(e)try{let e;e="tab"===t?await navigator.mediaDevices.getDisplayMedia({audio:!0,video:!1}):await navigator.mediaDevices.getUserMedia({audio:!0}),g.current=e,v.current=Date.now();let r=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});f.current=r,r.ondataavailable=e=>{e.data.size>0&&y(e.data)},r.start(),m(!0),k.current=setInterval(()=>{"recording"===r.state&&(r.stop(),setTimeout(()=>{var e;if(null===(e=g.current)||void 0===e?void 0:e.active){let e=new MediaRecorder(g.current,{mimeType:"audio/webm;codecs=opus"});e.ondataavailable=e=>{e.data.size>0&&y(e.data)},e.start(),f.current=e}},100))},5e3)}catch(e){console.error("Failed to start recording:",e)}},N=async t=>{if(!e)return;let r=new FormData;r.append("file",t),r.append("sessionId",e);let a=await fetch("/api/upload",{method:"POST",body:r}),s=await a.json();return s.filename&&b(e=>[...new Set([...e,s.filename])]),s},D=async t=>{if(!e)return;let r="temp-".concat(Date.now());x(e=>[...e,{id:r,role:"user",content:t}]);try{let r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,message:t})}),a=await r.json();a.content&&x(e=>[...e,{id:a.id,role:"assistant",content:a.content}])}catch(e){console.error("Chat error:",e),x(e=>[...e,{id:"err-".concat(Date.now()),role:"assistant",content:"Error getting response."}])}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsx)(n,{sessions:r,currentSessionId:e,isRecording:p,noteFiles:h,onSelectSession:t,onCreateSession:j,onStartRecording:w,onStopRecording:()=>{var e;k.current&&(clearInterval(k.current),k.current=null),(null===(e=f.current)||void 0===e?void 0:e.state)==="recording"&&f.current.stop(),g.current&&(g.current.getTracks().forEach(e=>e.stop()),g.current=null),f.current=null,m(!1)},onUploadFile:N}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsx)(d,{segments:i}),(0,a.jsx)(o,{messages:u,onSendMessage:D,sessionId:e})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3093)}),_N_E=e.O()}]);