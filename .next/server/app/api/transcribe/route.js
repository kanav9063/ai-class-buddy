"use strict";(()=>{var e={};e.id=93,e.ids=[93],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},320:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var r={};s.r(r),s.d(r,{POST:()=>m});var n=s(9303),i=s(8716),o=s(670),a=s(7070),u=s(4214),p=s(4672),d=s(2303),c=s(4673);let l=new u.ZP({apiKey:process.env.OPENAI_API_KEY});async function m(e){try{let t=await e.formData(),s=t.get("audio"),r=t.get("sessionId"),n=parseFloat(t.get("timestamp"))||0;if(!s||!r)return a.NextResponse.json({error:"Missing audio or sessionId"},{status:400});if(!p.h.getSession(r))return a.NextResponse.json({error:"Session not found"},{status:404});let i=(await l.audio.transcriptions.create({file:s,model:"whisper-1",response_format:"text"})).trim();if(!i)return a.NextResponse.json({text:"",id:null});let o=await (0,d.OC)(i),u={id:(0,c.Z)(),sessionId:r,text:i,timestamp:n,createdAt:Date.now(),embedding:o};return p.h.addTranscript(r,u),a.NextResponse.json({id:u.id,text:u.text,timestamp:u.timestamp})}catch(t){let e=t instanceof Error?t.message:"Transcription failed";return console.error("Transcribe error:",e),a.NextResponse.json({error:e},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/transcribe/route",pathname:"/api/transcribe",filename:"route",bundlePath:"app/api/transcribe/route"},resolvedPagePath:"/home/ubuntu/.openclaw/workspace-codegen/ai-class-buddy/src/app/api/transcribe/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:f}=h,b="/api/transcribe/route";function q(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},2303:(e,t,s)=>{s.d(t,{OC:()=>n,S1:()=>i,_B:()=>o,kZ:()=>a});let r=new(s(4214)).ZP({apiKey:process.env.OPENAI_API_KEY});async function n(e){return(await r.embeddings.create({model:"text-embedding-3-small",input:e})).data[0].embedding}async function i(e){return 0===e.length?[]:(await r.embeddings.create({model:"text-embedding-3-small",input:e})).data.map(e=>e.embedding)}function o(e,t,s=5){let r=t.map(t=>({text:t.text,score:function(e,t){let s=0,r=0,n=0;for(let i=0;i<e.length;i++)s+=e[i]*t[i],r+=e[i]*e[i],n+=t[i]*t[i];return s/(Math.sqrt(r)*Math.sqrt(n)+1e-10)}(e,t.embedding),source:t.source}));return r.sort((e,t)=>t.score-e.score),r.slice(0,s)}function a(e,t=500,s=50){let r=e.split(/\s+/),n=[];for(let e=0;e<r.length;e+=t-s){let s=r.slice(e,e+t).join(" ");s.trim()&&n.push(s.trim())}return n}},4672:(e,t,s)=>{s.d(t,{h:()=>i});class r{createSession(e,t,s){let r={id:e,name:t,className:s,createdAt:Date.now(),isRecording:!1,transcriptSegments:[],noteChunks:[],chatMessages:[]};return this.sessions.set(e,r),r}getSession(e){return this.sessions.get(e)}getAllSessions(){return Array.from(this.sessions.values()).sort((e,t)=>t.createdAt-e.createdAt)}addTranscript(e,t){let s=this.sessions.get(e);s&&s.transcriptSegments.push(t)}addNoteChunks(e,t){let s=this.sessions.get(e);s&&s.noteChunks.push(...t)}addChatMessage(e,t){let s=this.sessions.get(e);s&&s.chatMessages.push(t)}deleteSession(e){this.sessions.delete(e)}constructor(){this.sessions=new Map}}let n=globalThis;n.__store||(n.__store=new r);let i=n.__store}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,425],()=>s(320));module.exports=r})();