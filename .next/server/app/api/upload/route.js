"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4193:e=>{e.exports=require("pdf-parse")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},2623:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},2889:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{POST:()=>l});var n=s(9303),o=s(8716),a=s(670),i=s(7070),u=s(4672),d=s(2303),p=s(4673);async function l(e){try{let t;let r=await e.formData(),n=r.get("file"),o=r.get("sessionId");if(!n||!o)return i.NextResponse.json({error:"Missing file or sessionId"},{status:400});if(!u.h.getSession(o))return i.NextResponse.json({error:"Session not found"},{status:404});if(n.name.toLowerCase().endsWith(".pdf")){let e=Buffer.from(await n.arrayBuffer()),r=(await Promise.resolve().then(s.t.bind(s,4193,23))).default;t=(await r(e)).text}else t=await n.text();if(!t.trim())return i.NextResponse.json({error:"File appears empty"},{status:400});let a=(0,d.kZ)(t,400,50),l=await (0,d.S1)(a),c=a.map((e,t)=>({id:(0,p.Z)(),sessionId:o,filename:n.name,text:e,embedding:l[t],chunkIndex:t}));return u.h.addNoteChunks(o,c),i.NextResponse.json({filename:n.name,chunks:c.length,message:`Uploaded and indexed ${c.length} chunks from ${n.name}`})}catch(t){let e=t instanceof Error?t.message:"Upload failed";return console.error("Upload error:",e),i.NextResponse.json({error:e},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/home/ubuntu/.openclaw/workspace-codegen/ai-class-buddy/src/app/api/upload/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:g}=c,x="/api/upload/route";function f(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},2303:(e,t,s)=>{s.d(t,{OC:()=>n,S1:()=>o,_B:()=>a,kZ:()=>i});let r=new(s(4214)).ZP({apiKey:process.env.OPENAI_API_KEY});async function n(e){return(await r.embeddings.create({model:"text-embedding-3-small",input:e})).data[0].embedding}async function o(e){return 0===e.length?[]:(await r.embeddings.create({model:"text-embedding-3-small",input:e})).data.map(e=>e.embedding)}function a(e,t,s=5){let r=t.map(t=>({text:t.text,score:function(e,t){let s=0,r=0,n=0;for(let o=0;o<e.length;o++)s+=e[o]*t[o],r+=e[o]*e[o],n+=t[o]*t[o];return s/(Math.sqrt(r)*Math.sqrt(n)+1e-10)}(e,t.embedding),source:t.source}));return r.sort((e,t)=>t.score-e.score),r.slice(0,s)}function i(e,t=500,s=50){let r=e.split(/\s+/),n=[];for(let e=0;e<r.length;e+=t-s){let s=r.slice(e,e+t).join(" ");s.trim()&&n.push(s.trim())}return n}},4672:(e,t,s)=>{s.d(t,{h:()=>o});class r{createSession(e,t,s){let r={id:e,name:t,className:s,createdAt:Date.now(),isRecording:!1,transcriptSegments:[],noteChunks:[],chatMessages:[]};return this.sessions.set(e,r),r}getSession(e){return this.sessions.get(e)}getAllSessions(){return Array.from(this.sessions.values()).sort((e,t)=>t.createdAt-e.createdAt)}addTranscript(e,t){let s=this.sessions.get(e);s&&s.transcriptSegments.push(t)}addNoteChunks(e,t){let s=this.sessions.get(e);s&&s.noteChunks.push(...t)}addChatMessage(e,t){let s=this.sessions.get(e);s&&s.chatMessages.push(t)}deleteSession(e){this.sessions.delete(e)}constructor(){this.sessions=new Map}}let n=globalThis;n.__store||(n.__store=new r);let o=n.__store}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,425],()=>s(2889));module.exports=r})();